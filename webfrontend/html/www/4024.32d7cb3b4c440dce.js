"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4024],{4024:(U,d,i)=>{i.r(d),i.d(d,{SettingsPageModule:()=>S});var g=i(6814),r=i(6223),s=i(9843),p=i(9515),u=i(4282),c=i(5861),h=i(4345),t=i(5879),f=i(9140);function b(o,l){1&o&&t._UZ(0,"ion-back-button",12)}function v(o,l){1&o&&t._UZ(0,"ion-menu-button")}const T=[{path:"",component:(()=>{var o;class l{constructor(e,n,a,P,Z,_,C,M,k){this.translate=e,this.fb=n,this.alertController=a,this.router=P,this.loadingController=Z,this.storageService=_,this.route=C,this.navCtrl=M,this.ionRouterOutlet=k,this.mqttSettingsForm=h.KB,this.mqttForm=this.fb.group({mqtt_hostname:["",r.kI.required],mqtt_port:["",r.kI.required],mqtt_username:["",r.kI.required],mqtt_password:["",r.kI.required],mqtt_topic:["",r.kI.required]}),this.MQTTAddressLabel="MQTT server IP "+this.translate.instant("Address").toLowerCase(),this.MQTTWebsocketLabel="MQTT server websocket "+this.translate.instant("Port").toLowerCase(),this.MQTTUsernameLabel="MQTT server "+this.translate.instant("Username").toLowerCase(),this.MQTTPasswordLabel="MQTT server "+this.translate.instant("Password").toLowerCase()}ngOnInit(){this.canGoBack=this.ionRouterOutlet.canGoBack(),this.currentUrl=this.router.url,this.routerEvents=this.router.events.subscribe(e=>{e instanceof u.m2&&(this.previousUrl=this.currentUrl,this.currentUrl=e.url)}),this.storageService.settings$.subscribe(e=>{e&&e.mqtt&&this.updateForm(e.mqtt)})}updateForm(e){var n=this;return(0,c.Z)(function*(){e&&(e.hostname&&(n.mqttSettingsForm.hostname=e.hostname),e.port&&(n.mqttSettingsForm.port=e.port),e.username&&(n.mqttSettingsForm.username=e.username),e.password&&(n.mqttSettingsForm.password=e.password),e.topic&&(n.mqttSettingsForm.topic=e.topic),n.mqttForm&&n.mqttForm.setValue({mqtt_hostname:n.mqttSettingsForm.hostname,mqtt_port:n.mqttSettingsForm.port,mqtt_username:n.mqttSettingsForm.username,mqtt_password:n.mqttSettingsForm.password,mqtt_topic:n.mqttSettingsForm.topic}))})()}saveSettings(){var e=this;return(0,c.Z)(function*(){const n=yield e.loadingController.create({cssClass:"spinner",spinner:"crescent",message:"Please wait..."});yield n.present();let a=yield e.processFields(e.mqttForm);yield e.storageService.saveSettings({mqtt:{hostname:a.hostname,port:a.port,username:a.username,password:a.password,topic:a.topic}}),yield n.dismiss(),e.navCtrl.navigateRoot("")})()}cancel(){this.navCtrl.navigateRoot("")}reset(){var e=this;return(0,c.Z)(function*(){yield e.updateForm({hostname:"",port:null,username:"",password:"",topic:""}),e.storageService.cleanStorage()})()}processFields(e){return(0,c.Z)(function*(){let n=e.value.mqtt_hostname,a=e.value.mqtt_port;return n.includes("http://")&&(n=n.replace("http://","")),n.match(":[0-9]{4,6}")&&(a=Number(n.split(":")[1]),n=n.split(":")[0]),{hostname:n,port:a,username:e.value.mqtt_username,password:e.value.mqtt_password,topic:e.value.mqtt_topic}})()}ngOnDestroy(){this.routerEvents.unsubscribe()}}return(o=l).\u0275fac=function(e){return new(e||o)(t.Y36(p.sK),t.Y36(r.qu),t.Y36(s.Br),t.Y36(u.F0),t.Y36(s.HT),t.Y36(f.V1),t.Y36(u.gz),t.Y36(s.SH),t.Y36(s.jP))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-settings"]],decls:30,vars:20,consts:[["slot","start"],["defaultHref","previousUrl",4,"ngIf"],[4,"ngIf"],[3,"formGroup","ngSubmit"],[1,"input-group"],["labelPlacement","stacked","placeholder","IP Address","formControlName","mqtt_hostname",3,"label"],["labelPlacement","stacked","placeholder","Port","formControlName","mqtt_port",3,"label"],["labelPlacement","stacked","placeholder","Username","formControlName","mqtt_username",3,"label"],["type","password","labelPlacement","stacked","placeholder","Password","formControlName","mqtt_password",3,"label"],["label","MQTT topic","labelPlacement","stacked","placeholder","MQTT Topic","formControlName","mqtt_topic"],["type","submit","expand","block",3,"disabled"],["expand","block",1,"btn_light",3,"click"],["defaultHref","previousUrl"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t.YNc(3,b,1,0,"ion-back-button",1),t.YNc(4,v,1,0,"ion-menu-button",2),t.qZA(),t.TgZ(5,"ion-title"),t._uU(6),t.ALo(7,"translate"),t.qZA()()(),t.TgZ(8,"ion-content")(9,"form",3),t.NdJ("ngSubmit",function(){return n.saveSettings()}),t.TgZ(10,"div",4)(11,"ion-item"),t._UZ(12,"ion-input",5),t.qZA(),t.TgZ(13,"ion-item"),t._UZ(14,"ion-input",6),t.qZA(),t.TgZ(15,"ion-item"),t._UZ(16,"ion-input",7),t.qZA(),t.TgZ(17,"ion-item"),t._UZ(18,"ion-input",8),t.qZA(),t.TgZ(19,"ion-item"),t._UZ(20,"ion-input",9),t.qZA()(),t.TgZ(21,"ion-button",10),t._uU(22),t.ALo(23,"translate"),t.qZA()(),t.TgZ(24,"ion-button",11),t.NdJ("click",function(){return n.cancel()}),t._uU(25),t.ALo(26,"translate"),t.qZA(),t.TgZ(27,"ion-button",11),t.NdJ("click",function(){return n.reset()}),t._uU(28),t.ALo(29,"translate"),t.qZA()()),2&e&&(t.xp6(3),t.Q6J("ngIf",n.canGoBack),t.xp6(1),t.Q6J("ngIf",!n.canGoBack),t.xp6(2),t.Oqu(t.lcZ(7,12,"Settings")),t.xp6(3),t.Q6J("formGroup",n.mqttForm),t.xp6(3),t.s9C("label",n.MQTTAddressLabel),t.xp6(2),t.s9C("label",n.MQTTWebsocketLabel),t.xp6(2),t.s9C("label",n.MQTTUsernameLabel),t.xp6(2),t.s9C("label",n.MQTTPasswordLabel),t.xp6(3),t.Q6J("disabled",!n.mqttForm.valid),t.xp6(1),t.Oqu(t.lcZ(23,14,"Save settings")),t.xp6(3),t.Oqu(t.lcZ(26,16,"Cancel")),t.xp6(3),t.Oqu(t.lcZ(29,18,"Reset")))},dependencies:[g.O5,r._Y,r.JJ,r.JL,s.oU,s.YG,s.Sm,s.W2,s.Gu,s.pK,s.Ie,s.fG,s.wd,s.sr,s.j9,s.cs,r.sg,r.u,p.X$],styles:[".btn_light[_ngcontent-%COMP%]{--background: var(--ion-card-background, #ffffff);color:var(--ion-text-color, #666666)}ion-input[_ngcontent-%COMP%]   .label-text[_ngcontent-%COMP%]   .sc-ion-input-md[_ngcontent-%COMP%]{color:red!important}"]}),l})()}];let q=(()=>{var o;class l{}return(o=l).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[u.Bz.forChild(T),u.Bz]}),l})(),S=(()=>{var o;class l{}return(o=l).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[g.ez,r.u5,s.Pc,q,r.UX,p.aw]}),l})()}}]);